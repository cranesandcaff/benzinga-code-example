angular.module("benzingaStockExchangeApp",["ngAnimate","ngSanitize","ngStorage"]),function(t){try{t=angular.module("benzingaStockExchangeApp")}catch(n){t=angular.module("benzingaStockExchangeApp",[])}t.run(["$templateCache",function(t){t.put("globalTemplates/header.html",'<header class="global"><h3>Simple Stock Exchange</h3><form ng-submit="marketSearch(symbol)" class="search" name="search"><input type="text" name="symbol_search" ng-model="symbol" placeholder="Enter Symbol"> <button name="lookup">Lookup</button></form></header>')}])}(),function(t){try{t=angular.module("benzingaStockExchangeApp")}catch(n){t=angular.module("benzingaStockExchangeApp",[])}t.run(["$templateCache",function(t){t.put("portfolio/templates/currentPortfolio.html",'<section class="portfolio"><header><h4>Current Portfolio</h4><h4 ng-bind="\'Cash: \'+ portfolio.balance"></h4></header><table class="table"><tr><th>Company</th><th>Quantity</th><th colspan="2">Price Paid</th></tr><tr ng-repeat="stock in portfolio.owned"><td ng-bind="stock.name"></td><td ng-bind="stock.quantity"></td><td ng-bind="stock.vwap | currency"></td><td><button ng-click="marketSearch(stock.symbol)">View Stock</button></td></tr></table></section>')}])}(),function(t){try{t=angular.module("benzingaStockExchangeApp")}catch(n){t=angular.module("benzingaStockExchangeApp",[])}t.run(["$templateCache",function(t){t.put("portfolio/templates/details.html",'<section class="details"><div ng-show="currentCompany"><header><h3 ng-bind="currentCompany.name"></h3></header><table class="table"><tr><th>Bid</th><th>Ask</th></tr><tr><td ng-bind="currentCompany.bid | currency"></td><td ng-bind="currentCompany.ask | currency"></td></tr></table><input type="number" name="symbol_search" ng-model="quantity" placeholder="Quantity" min="0"> <button name="buy" class="btn" ng-click="buy(currentCompany, quantity)">Buy</button> <button name="sell" class="btn" ng-click="sell(currentCompany, quantity)">Sell</button></div><div ng-hide="currentCompany" class="fx-fade-up"><h2>Search for a symbol in the upper right hand corner.</h2></div></section>')}])}(),angular.module("benzingaStockExchangeApp").factory("Portfolio",["$http","$sessionStorage","FlashService",function(t,n,o){return{balance:1e5,potential:!1,owned:[],init:function(){var t=n.portfolio;_.merge(this,t)},store:function(){var t=_.pick(this,["balance","owned"]);n.portfolio=t},search:function(n){return t.get("http://data.benzinga.com/stock/"+n).success(function(t){"error"===t.status?o.show("error","No results for that symbol, try again?"):this.potential=t}.bind(this))},vwap:function(t){function n(t){a+=t.quantity,o+=t.quantity*parseFloat(t.price),e+=t.purchase?t.quantity:-t.quantity}for(var o=0,e=0,a=0,r=0,i=t.transactionHistory.length;i>r;r++)n(t.transactionHistory[r]);return t.quantity=e,o/a},transaction:function(t,n,o){var e=_.some(this.owned,{symbol:t.symbol});e?t=_.find(this.owned,t):(t.transactionHistory=[],this.owned.push(t)),t.transactionHistory.push({quantity:n,price:t.ask,purchase:o}),t.vwap=this.vwap(t)},buy:function(t,n){var e=_.pick(t,["symbol","name","ask","bid"]);e.details=t;var a=e.ask*n,r=this.balance-a;r>0?(this.transaction(e,n,!0),this.balance=r,this.store()):o.show("error","You don't have enough money to purchase this amount.")},sell:function(t,n){var e=t.bid*n,a=_.some(this.owned,{symbol:t.symbol});if(a){var r=_.find(this.owned,{symbol:t.symbol}),i=this.balance+e,c=r.quantity-n;c>=0?(this.transaction(r,n,!1),r.quantity<=0&&_.remove(this.owned,r),this.balance=i,this.store()):o.show("error","You don't have that much stock to sell.")}else o.show("error","You don't own that stock.")}}}]),angular.module("benzingaStockExchangeApp").controller("portfolioCtrl",["$scope","$filter","Portfolio",function(t,n,o){function e(){t.portfolio.balance=n("currency")(o.balance)}o.init(),t.portfolio={},t.portfolio.balance=n("currency")(o.balance),t.portfolio.owned=o.owned,t.symbol="",t.marketSearch=function(n){o.search(n).success(function(){t.currentCompany=o.potential})},t.buy=function(t,n){o.buy(t,n),e()},t.sell=function(t,n){o.sell(t,n),e()}}]),angular.module("benzingaStockExchangeApp").factory("FlashService",["$rootScope",function(t){return{show:function(n,o){t.flash={type:n,message:o,unread:!0},t.removeFlash=function(){t.flash={unread:!1}}},remove:function(){t.flash={unread:!1}}}}]);